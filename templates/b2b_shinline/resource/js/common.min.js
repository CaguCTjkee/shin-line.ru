$.extend({openDialog:function(a){a=$.extend({url:"",width:null,data:null,callback:null,colorboxOptions:{},bindSubmit:true},a);var b=$.extend({open:true,width:(a.width)?a.width:false,opacity:0.4,onClosed:function(){d.abort()}},a.colorboxOptions);var c=function(f){if(a.bindSubmit){$("#cboxLoadedContent").each(function(){var g=this;$(g).trigger("new-content");$("form",this).each(function(){var h=$(this).attr("data-ajax-action");if(typeof(h)!="undefined"){$(this).attr("action",h)}$(this).ajaxForm({dataType:"json",data:{dialogWrap:1},beforeSubmit:function(i,k,j){$('button[type="submit"], input[type="submit"]',k).attr("disabled","disabled")},success:function(i){if(i.closeDialog){$.colorbox.close()}if(i.reloadPage){location.reload();return}if(!i.closeDialog){$(g).empty();var j=$("<div>").hide().appendTo("body").append(i.html);$.colorbox($.extend({html:j.show()},b));c()}}})})})}if(a.callback){a.callback(f)}};var e=a.url.indexOf("?")==-1?"?dialogWrap=1":"&dialogWrap=1";var d=$.get(a.url+e,a.data,function(g){var h=$("<div>").hide().appendTo("body").append(g.html);var f=h.find("[data-dialog-options]").data("dialogOptions");if(f){b=$.extend(b,f)}$.colorbox($.extend({html:h.show(),onComplete:function(){c(g)}},b))},"json");$.colorbox(b);return false},cart:function(a){var f={cartTotalPrice:".cost .value",cartTotalItems:".products .value",cartPriceBlock:false,productWrapper:".productItem",update:".recalc",inLoadingClass:"inloading",couponField:".couponCode",couponError:".couponError",saveScroll:".viewport",addToCart:".addToCart",noShowCart:false,applyCoupon:".applyCoupon",cartBlock:"#cartItems",cartForm:"#cartForm",cartItem:".cartitem",amountWraper:".colAmount",amountField:".fieldAmount",showCart:".showCart",checkout:".submit",clearCart:".clearCart",offerField:".offer",cartItemInc:".inc",cartItemDec:".dec",cartItemRemove:".remove",removeCoupon:".linesContainer .remove",context:"[data-id]",offerFormName:"offer",multiOffersName:"multioffers[items]",multiofferFormName:"[multioffers][",multiofferHidden:'[name^="hidden_offers"]',amountFormName:"amount",alreadyInCartClass:"added",alreadyInCartClassTimeout:5,alreadyInCartBlock:false,alreadyInCartBlockTimeout:5,concomitantCheckboxName:"concomitant[",concomitantField:".fieldConcomitant",concomitantAmountClass:"concomitant",toggleOneClickCart:".toggleOneClickCart",continueButton:".continue"},e=$("#cart"),i=true;if(!e.length){e=$("body");i=false}var t=e.data("cart");if(!t){t={options:f};e.data("cart",t)}var r={init:function(u){t.options.url=e.data("compareUrl");t.options=$.extend(t.options,u);$("body").on("click.cart",t.options.addToCart,p);$(t.options.showCart).click(function(){return r.add($(this).attr("href"))});l()},add:function(u,y,w,A,v,x){if($.detectMedia&&($.detectMedia("mobile")||$.detectMedia("portrait"))){return true}var z={};if(y){z.offer=y}if(v){z.amount=v}if(w){z=$.extend(z,w)}if(A){z=$.extend(z,A)}if(!x){$.openDialog({url:u,data:z,callback:l,colorboxOptions:{width:940,className:"noBorder cartDialog"},bindSubmit:false})}else{$.post(u,z,function(B){try{window.opener.jQuery.cart("updateCartBlock",B)}catch(C){$.cart("updateCartBlock",B)}},"json")}$(this).trigger("product.add",{url:u,offer:y,multioffers:w,concomitants:A,amount:v,noShowCartDialog:x});return false},updateCartBlock:function(u){if(u){$(t.options.cartTotalItems,e).text(u.cart.items_count);$(t.options.cartTotalPrice,e).text(u.cart.total_price);$(t.options.cartPriceBlock).toggle(parseInt(u.cart.total_price)>0)}},refresh:function(u,w){var v=$(t.options.cartForm).serializeArray();if(!u){u=$(t.options.cartForm).attr("action")}b();$("input, select",t.cartBlock).prop("disabled",true);$.ajax({url:u,data:v,type:"POST",dataType:"json",success:function(x){if(x.redirect){location.href=x.redirect}var z=$(t.options.saveScroll,t.cartBlock),y=z.scrollTop();t.cartBlock.replaceWith(x.html);l(x);$(t.options.saveScroll,t.cartBlock).scrollTop(y);$.colorbox.resize();$('input[type="checkbox"]').styler();if(w){w()}}})}};var p=function(){var G=this;$(this).addClass(t.options.alreadyInCartClass);if(!$(this).data("storedText")&&$(this).data("addText")){$(this).data("storedText",$(this).html());$(this).html($(this).data("addText"))}var H=function(){$(G).removeClass(t.options.alreadyInCartClass);if($(G).data("storedText")){$(G).html($(G).data("storedText"));$(G).data("storedText",null)}};if(t.options.alreadyInCartClassTimeout){setTimeout(H,t.options.alreadyInCartClassTimeout*1000)}if(t.options.alreadyInCartBlock){var B=$(t.options.alreadyInCartBlock);clearTimeout(B.data("timer"));var w=function(K){if(K&&$(K.target).is(t.options.addToCart)){return}B.fadeOut()};B.fadeIn().click(function(K){K.stopPropagation()});$("body").one("click",w);B.data("timer",setTimeout(w,t.options.alreadyInCartClassTimeout*1000))}var x=$(this).closest(t.options.context);if($('[name="'+t.options.offerFormName+'"]:checked',x).length){var I=$('[name="'+t.options.offerFormName+'"]:checked',x).val()}else{var I=$('[name="'+t.options.offerFormName+'"]',x).val()}var F=$('[name="'+t.options.amountFormName+'"]',x).val();if($('[name^="multioffers["]',x).length){var D={};$('[name^="multioffers["]',x).each(function(K){if(!$(this).is(":radio")||$(this).is(":checked")){pid=$(this).attr("name");D[pid]=$(this).val()}})}if($('[name^="'+t.options.concomitantCheckboxName+'"]:checked',x).length){var z={};$('[name^="'+t.options.concomitantCheckboxName+'"]:checked',x).each(function(L){var K="concomitant["+L+"]";z[K]=$(this).val()})}var E=$(this).hasClass("noShowCart")||t.options.noShowCart;var v=$(this).data("href")?$(this).data("href"):$(this).attr("href");var A=F?F:1;var J=(I)?I:0;var u=(D)?D:false;var y=(z)?z:false;if($.detectMedia&&($.detectMedia("mobile")||$.detectMedia("portrait"))){var C={amount:A,offer:J};if(u){$.extend(C,u)}if(y){$.extend(C,y)}location.href=v+(v.indexOf("?")==-1?"?":"&")+$.param(C);return false}console.log(v);return r.add.call(this,v,J,u,y,F,E)},l=function(u){t.cartBlock=$(t.options.cartBlock);if(t.cartBlock.length){t.cartBlock.on("click",t.options.cartItemInc,h).on("click",t.options.cartItemDec,j).on("blur",t.options.amountField,function(){var v=(+$(this).val());if(v<1){$(this).val(1).keyup()}}).on("focus",t.options.amountField,function(w,v){if(!v){this.select()}}).on("keyup",t.options.amountField,m).on("change",t.options.concomitantField,m).on("change",t.options.offerField,function(){r.refresh()}).on("change",'[name*="'+t.options.multiofferFormName+'"]',n).on("click",t.options.continueButton,function(){$(this).closest("#colorbox").length?$.colorbox.close():history.back();return false}).on("click",t.options.toggleOneClickCart,function(){$.oneClickCart("triggerBlockTrigger");return false}).on("click",t.options.cartItemRemove,d).on("click",t.options.clearCart,k).on("click",t.options.applyCoupon,s).on("click",t.options.checkout,q);$(t.options.cartForm,t.cartBlock).submit(function(){clearTimeout(t.cartBlock.data("changeTimer"));r.refresh();return false});$(t.options.update,t.cartBlock).hide()}r.updateCartBlock(u);$('input[type="checkbox"]').styler()},n=function(){var u=$(this).closest(t.options.context);var x=$(t.options.multiofferHidden,u);if(x.length>0){var C=$('[name*="['+t.options.offerFormName+']"]',u);var D=[];var z=$('[name*="'+t.options.multiofferFormName+'"]',u);x.each(function(F){D[F]={};D[F]["id"]=this;D[F]["info"]=$(this).data("info");D[F]["num"]=$(this).data("num");D[F]["value"]=$(this).val()});$(z).each(function(F){z[F]={};z[F]["title"]=$(this).data("prop-title");z[F]["value"]=$(this).val()});var y=false;for(var A=0;A<D.length;A++){var v=D[A]["info"];var E=0;for(var w=0;w<v.length;w++){for(var B=0;B<z.length;B++){if((z[B]["title"]==v[w][0])&&(z[B]["value"]==v[w][1])){E++}}if(E==z.length){y=D[A];break}}}$(u).removeClass("notAvaliable");if(y){C.val(y.value)}else{C.val(0)}}r.refresh()},h=function(){if(!t.cartBlock.hasClass(t.options.inLoadingClass)){var u=$(this).closest(t.options.amountWraper).find(t.options.amountField);u.val((+u.val())+1).keyup()}return false},j=function(){if(!t.cartBlock.hasClass(t.options.inLoadingClass)){var u=$(this).closest(t.options.amountWraper).find(t.options.amountField);if((+u.val())>1){u.val((+u.val())-1).keyup()}}return false},g=function(){return false},d=function(){if(!t.cartBlock.hasClass(t.options.inLoadingClass)){var v=$(this).closest(t.options.cartItem);v.css("opacity",0.5).addClass("removing");var u=v.siblings('[data-product-id="'+v.data("productId")+'"]');if(!u.length){var w=$(t.options.productWrapper+'[data-id="'+v.data("productId")+'"]');$(t.options.addToCart,w).removeClass(t.options.alreadyInCartClass)}r.refresh($(this).attr("href"))}return false},b=function(){t.cartBlock.addClass(t.options.inLoadingClass)},c=function(){t.cartBlock.removeClass(t.options.inLoadingClass)},m=function(u){if(u.keyCode!=13){var w=$(this);var v=w.closest(t.options.cartItem).index();clearTimeout(t.cartBlock.data("changeTimer"));t.cartBlock.data("changeTimer",setTimeout(function(){if(w.val()!=""){r.refresh(null,function(){$(t.options.cartItem,t.cartBlock).eq(v).find(t.options.amountField).each(function(){$(this).trigger("focus",true);var x=$(this).val();$(this).val("").val(x)})})}},500))}},k=function(){var u=$(t.options.productWrapper+"[data-id]");$(t.options.addToCart,u).removeClass(t.options.alreadyInCartClass);return o.call(this)},o=function(){r.refresh($(this).attr("href"));return false},s=function(){r.refresh()},q=function(v){if($(this).hasClass("disabled")){return false}var u=$(t.options.cartForm).attr("action");var w=(u.indexOf("?")>-1?"&":"?")+"checkout=1";r.refresh(u+w);return false};if(r[a]){r[a].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof a==="object"||!a){return r.init.apply(this,arguments)}}}});$.fn.extend({openInDialog:function(c){var b={},a=arguments;return this.each(function(){var f=$(this),e=f.data("openInDialog");var d={init:function(h){if(e){return}e={};f.data("openInDialog",e);e.options=$.extend({},b,h);f.click(g)}};var g=function(){$.openDialog({url:$(this).data("href")?$(this).data("href"):$(this).attr("href")});return false};if(d[c]){d[c].apply(this,Array.prototype.slice.call(a,1))}else{if(typeof c==="object"||!c){return d.init.apply(this,a)}}})}});